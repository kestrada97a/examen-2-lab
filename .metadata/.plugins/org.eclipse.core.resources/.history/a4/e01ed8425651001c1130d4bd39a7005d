#include "parser.h"

/** \brief Parsea los datos los datos de los libros desde el archivo libro.csv (modo texto).
 *
 * \param path char*
 * \param pArrayListLibro LinkedList*
 * \return int
 *
 */
int parser_libroFromText(FILE* pFile, LinkedList* pArrayListLibro)
{
	int idAux;
	char id[100];
	char titulo[100];
	char autor[100];
	char precio[25];
	char idEditorial[25];
	eLibro* pLibro;
	fscanf(pFile,"%[^,],%[^,],%[^,],%[^,],%[^\n]\n",id,titulo,autor,precio,idEditorial);
	while(!feof(pFile))
	{
		fscanf(pFile,"%[^,],%[^,],%[^,],%[^,],%[^\n]\n",id,titulo,autor,precio,idEditorial);
		pLibro = libro_newParametros(id, titulo, autor, precio, idEditorial);
		ll_add(pArrayListLibro,pLibro);
		libro_getId(pLibro, &idAux);
	}
	return idAux;

}

/** \brief Parsea los datos los datos de las editoriales desde el archivo editorial.csv (modo texto).
 *
 * \param path char*
 * \param pArrayListEditorial LinkedList*
 * \return int
 *
 */
int parser_editorialFromText(FILE* pFile, LinkedList* pArrayListEditorial)
{
	int idAux;
	char idEditorial[25];
	char nombre[100];
	eEditorial* pEditorial;
	fscanf(pFile,"%[^,],%[^\n]\n",idEditorial,nombre);
	while(!feof(pFile))
	{
	fscanf(pFile,"%[^,],%[^\n]\n",idEditorial,nombre);
	pEditorial= editorial_newParametros(idEditorial, nombre);
	ll_add(pArrayListEditorial,pEditorial);
	editorial_getId(pEditorial, &idAux);
	}
	return idAux;
}

/** \brief Parsea los datos los datos de los libros desde el archivo libro.csv (modo binario).
 *
 * \param path char*
 * \param pArrayListLibro LinkedList*
 * \return int
 *
 */
int parser_libroFromBinary(FILE* pFile, LinkedList* pArrayListLibro)
{
	int idAux=-1;
	int i=0;
	eLibro* pLibro;
	while(!feof(pFile))
	{
		pLibro=libro_new();
		fread(pLibro,sizeof(pLibro),1,pFile);
		if(pLibro!=NULL)
		{
			i++;
			pLibro=ll_get(pArrayListLibro,i);
			libro_getId(pLibro,&idAux);
		}
	}
	return idAux;

}

/** \brief Parsea los datos los datos de las editoriales desde el archivo editorial.csv (modo binario).
 *
 * \param path char*
 * \param pArrayListEditorial LinkedList*
 * \return int
 *
 */
int parser_editorialFromBinary(FILE* pFile, LinkedList* pArrayListEditorial)
{
	int idAux=-1;
	int i=0;
	eEditorial* pEditorial;
	while(!feof(pFile))
	{
		pEditorial=editorial_new();
		fread(pEditorial,sizeof(pEditorial),1,pFile);
		if(pEditorial!=NULL)
		{
			i++;
			pEditorial=ll_get(pArrayListEditorial,i);
			editorial_getId(pEditorial, &idAux);
		}
	}
	return idAux;
}
